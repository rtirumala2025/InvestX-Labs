# ğŸ—ï¸ User Service Architecture

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Frontend Application                     â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  Dashboard   â”‚  â”‚   Profile    â”‚  â”‚  Settings    â”‚         â”‚
â”‚  â”‚  Component   â”‚  â”‚  Component   â”‚  â”‚  Component   â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚         â”‚                 â”‚                 â”‚                   â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                           â”‚                                     â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                  â”‚  userService.js â”‚                            â”‚
â”‚                  â”‚                 â”‚                            â”‚
â”‚                  â”‚  â€¢ getUserProfile                            â”‚
â”‚                  â”‚  â€¢ updateUserProfile                         â”‚
â”‚                  â”‚  â€¢ getUserPreferences                        â”‚
â”‚                  â”‚  â€¢ updateUserPreferences                     â”‚
â”‚                  â”‚  â€¢ Cache Management                          â”‚
â”‚                  â”‚  â€¢ Error Handling                            â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                           â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Supabase Client
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Supabase Platform                           â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    PostgREST API                        â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  RPC Endpoints:                                        â”‚    â”‚
â”‚  â”‚  â€¢ /rest/v1/rpc/get_user_profile                      â”‚    â”‚
â”‚  â”‚  â€¢ /rest/v1/rpc/update_user_profile                   â”‚    â”‚
â”‚  â”‚  â€¢ /rest/v1/rpc/get_user_preferences                  â”‚    â”‚
â”‚  â”‚  â€¢ /rest/v1/rpc/update_user_preferences               â”‚    â”‚
â”‚  â”‚  â€¢ /rest/v1/rpc/check_user_rpcs_health                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                       â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              PostgreSQL Database                        â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  Functions:                                            â”‚    â”‚
â”‚  â”‚  â€¢ get_user_profile(p_user_id UUID)                   â”‚    â”‚
â”‚  â”‚  â€¢ update_user_profile(p_user_id UUID, ...)           â”‚    â”‚
â”‚  â”‚  â€¢ get_user_preferences(p_user_id UUID)               â”‚    â”‚
â”‚  â”‚  â€¢ update_user_preferences(p_user_id UUID, ...)       â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  Tables:                                               â”‚    â”‚
â”‚  â”‚  â€¢ user_profiles                                       â”‚    â”‚
â”‚  â”‚  â€¢ user_preferences                                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow

### Read Operation (with Cache)

```
Component Request
    â”‚
    â–¼
getUserProfile(userId)
    â”‚
    â–¼
Check Cache â”€â”€â”€â”€â–º Cache HIT â”€â”€â”€â”€â–º Return Cached Data
    â”‚                                      â”‚
    â”‚ Cache MISS                           â”‚
    â–¼                                      â”‚
Call Supabase RPC                          â”‚
    â”‚                                      â”‚
    â–¼                                      â”‚
supabase.rpc('get_user_profile')           â”‚
    â”‚                                      â”‚
    â–¼                                      â”‚
Supabase PostgREST                         â”‚
    â”‚                                      â”‚
    â–¼                                      â”‚
PostgreSQL Function                        â”‚
    â”‚                                      â”‚
    â–¼                                      â”‚
Return JSONB Data                          â”‚
    â”‚                                      â”‚
    â–¼                                      â”‚
Store in Cache (TTL: 5 min)                â”‚
    â”‚                                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
        Return to Component
```

### Write Operation (with Cache Invalidation)

```
Component Update Request
    â”‚
    â–¼
updateUserProfile(userId, updates)
    â”‚
    â–¼
Call Supabase RPC
    â”‚
    â–¼
supabase.rpc('update_user_profile')
    â”‚
    â–¼
Supabase PostgREST
    â”‚
    â–¼
PostgreSQL Function
    â”‚
    â–¼
Update Database
    â”‚
    â–¼
Return Updated Data
    â”‚
    â–¼
Invalidate Cache â”€â”€â”€â”€â–º Clear Old Cache Entry
    â”‚
    â–¼
Store New Data in Cache (TTL: 5 min)
    â”‚
    â–¼
Return to Component
```

## Cache Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    In-Memory Cache (Map)                     â”‚
â”‚                                                              â”‚
â”‚  Key: "profile:user-123"                                    â”‚
â”‚  Value: {                                                   â”‚
â”‚    data: { user_id, email, full_name, ... },               â”‚
â”‚    expiresAt: 1706198400000  (now + 5 min)                 â”‚
â”‚  }                                                          â”‚
â”‚                                                              â”‚
â”‚  Key: "preferences:user-123"                                â”‚
â”‚  Value: {                                                   â”‚
â”‚    data: { user_id, theme, language, ... },                â”‚
â”‚    expiresAt: 1706199000000  (now + 10 min)                â”‚
â”‚  }                                                          â”‚
â”‚                                                              â”‚
â”‚  Operations:                                                â”‚
â”‚  â€¢ getCachedData(type, userId)  â†’ Check & return if valid  â”‚
â”‚  â€¢ setCachedData(type, userId, data, ttl)  â†’ Store with TTLâ”‚
â”‚  â€¢ invalidateCache(type, userId)  â†’ Delete entry           â”‚
â”‚  â€¢ clearAllCache()  â†’ Clear entire cache                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Testing Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Test Suite                           â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Unit Tests (Jest)                       â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  â€¢ Mock Supabase Client                             â”‚  â”‚
â”‚  â”‚  â€¢ Test Cache Logic                                 â”‚  â”‚
â”‚  â”‚  â€¢ Test Error Handling                              â”‚  â”‚
â”‚  â”‚  â€¢ Test Mock Fallbacks                              â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  Run: npm run test:user                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           Integration Tests (Node.js)                â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  â€¢ Real Supabase Connection                         â”‚  â”‚
â”‚  â”‚  â€¢ Test All RPCs                                    â”‚  â”‚
â”‚  â”‚  â€¢ Verify Health Check                              â”‚  â”‚
â”‚  â”‚  â€¢ Test CRUD Operations                             â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  Run: npm run test:integration                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚            Service Tests (Node.js)                   â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  â€¢ End-to-End Validation                            â”‚  â”‚
â”‚  â”‚  â€¢ Cache Performance                                â”‚  â”‚
â”‚  â”‚  â€¢ Update Operations                                â”‚  â”‚
â”‚  â”‚  â€¢ Complete User Data                               â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  Run: npm run test:service                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           RPC Health Check (Node.js)                 â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  â€¢ Verify RPCs Exist                                â”‚  â”‚
â”‚  â”‚  â€¢ Test Each Function                               â”‚  â”‚
â”‚  â”‚  â€¢ Health Report                                    â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  Run: node backend/scripts/checkSupabaseRPCs.js     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## CI/CD Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     GitHub Actions                           â”‚
â”‚                                                              â”‚
â”‚  Trigger: Push/PR to main/develop                           â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚
â”‚  â”‚   Unit     â”‚  â”€â”€â–º Run Jest Tests                         â”‚
â”‚  â”‚   Tests    â”‚  â”€â”€â–º Upload Coverage                        â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚
â”‚       â”‚ âœ… Pass                                             â”‚
â”‚       â–¼                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚
â”‚  â”‚Integration â”‚  â”€â”€â–º Test Real Supabase                     â”‚
â”‚  â”‚   Tests    â”‚  â”€â”€â–º Verify RPCs                            â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚
â”‚       â”‚ âœ… Pass                                             â”‚
â”‚       â–¼                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚
â”‚  â”‚  Service   â”‚  â”€â”€â–º Comprehensive Tests                    â”‚
â”‚  â”‚   Tests    â”‚  â”€â”€â–º Verbose Output                         â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚
â”‚       â”‚ âœ… Pass                                             â”‚
â”‚       â–¼                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚
â”‚  â”‚  Supabase  â”‚  â”€â”€â–º Health Check                           â”‚
â”‚  â”‚   Health   â”‚  â”€â”€â–º Verify All RPCs                        â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚
â”‚       â”‚ âœ… Pass                                             â”‚
â”‚       â–¼                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚
â”‚  â”‚  Summary   â”‚  â”€â”€â–º Aggregate Results                      â”‚
â”‚  â”‚            â”‚  â”€â”€â–º Post to PR                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚
â”‚                                                              â”‚
â”‚  Result: âœ… All Tests Passed / âŒ Build Failed              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Error Handling Flow

```
Component Call
    â”‚
    â–¼
userService Function
    â”‚
    â–¼
Try Block
    â”‚
    â”œâ”€â–º Supabase RPC Call
    â”‚       â”‚
    â”‚       â–¼
    â”‚   Success? â”€â”€â–º Yes â”€â”€â–º Return Data
    â”‚       â”‚
    â”‚       No
    â”‚       â”‚
    â”‚       â–¼
    â”‚   Catch Block
    â”‚       â”‚
    â”‚       â–¼
    â”‚   Log Error (logError)
    â”‚       â”‚
    â”‚       â–¼
    â”‚   Development Mode?
    â”‚       â”‚
    â”‚       â”œâ”€â–º Yes â”€â”€â–º Return Mock Data
    â”‚       â”‚
    â”‚       â””â”€â–º No â”€â”€â–º Throw Error
    â”‚                       â”‚
    â”‚                       â–¼
    â”‚               Component Error Boundary
    â”‚                       â”‚
    â”‚                       â–¼
    â”‚               Display Error UI
    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Performance Optimization

### Without Cache
```
Request 1: 150ms (Supabase RPC)
Request 2: 145ms (Supabase RPC)
Request 3: 148ms (Supabase RPC)
Request 4: 152ms (Supabase RPC)
Request 5: 147ms (Supabase RPC)

Total: 742ms
Average: 148.4ms
```

### With Cache
```
Request 1: 150ms (Supabase RPC) â”€â”€â–º Cache Miss
Request 2:   2ms (Cache Hit)    â”€â”€â–º Cache Hit
Request 3:   1ms (Cache Hit)    â”€â”€â–º Cache Hit
Request 4:   2ms (Cache Hit)    â”€â”€â–º Cache Hit
Request 5:   1ms (Cache Hit)    â”€â”€â–º Cache Hit

Total: 156ms
Average: 31.2ms
Improvement: 79% faster
```

## Security Model

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Security Layers                           â”‚
â”‚                                                              â”‚
â”‚  Frontend (Browser)                                         â”‚
â”‚  â”‚                                                           â”‚
â”‚  â”œâ”€â–º Supabase Anon Key (Public)                            â”‚
â”‚  â”‚   â€¢ Limited permissions                                  â”‚
â”‚  â”‚   â€¢ Row Level Security (RLS)                            â”‚
â”‚  â”‚                                                           â”‚
â”‚  â–¼                                                           â”‚
â”‚  Supabase PostgREST                                         â”‚
â”‚  â”‚                                                           â”‚
â”‚  â”œâ”€â–º JWT Authentication                                     â”‚
â”‚  â”‚   â€¢ Verify user identity                                â”‚
â”‚  â”‚   â€¢ Check permissions                                    â”‚
â”‚  â”‚                                                           â”‚
â”‚  â–¼                                                           â”‚
â”‚  PostgreSQL Functions                                       â”‚
â”‚  â”‚                                                           â”‚
â”‚  â”œâ”€â–º SECURITY DEFINER                                       â”‚
â”‚  â”‚   â€¢ Execute with function owner privileges              â”‚
â”‚  â”‚   â€¢ Controlled access                                    â”‚
â”‚  â”‚                                                           â”‚
â”‚  â”œâ”€â–º Parameter Validation                                   â”‚
â”‚  â”‚   â€¢ Type checking                                        â”‚
â”‚  â”‚   â€¢ Input sanitization                                   â”‚
â”‚  â”‚                                                           â”‚
â”‚  â””â”€â–º Row Level Security (RLS)                               â”‚
â”‚      â€¢ User can only access own data                        â”‚
â”‚      â€¢ Enforced at database level                           â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Deployment Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Production Environment                    â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Frontend (Vercel/Netlify)               â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  â€¢ React App (Port 3002)                            â”‚  â”‚
â”‚  â”‚  â€¢ userService.js                                   â”‚  â”‚
â”‚  â”‚  â€¢ In-Memory Cache                                  â”‚  â”‚
â”‚  â”‚  â€¢ Environment Variables                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                       â”‚                                     â”‚
â”‚                       â”‚ HTTPS                               â”‚
â”‚                       â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           Supabase Cloud (Managed)                   â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  â€¢ PostgREST API                                    â”‚  â”‚
â”‚  â”‚  â€¢ PostgreSQL Database                              â”‚  â”‚
â”‚  â”‚  â€¢ Authentication                                   â”‚  â”‚
â”‚  â”‚  â€¢ Row Level Security                               â”‚  â”‚
â”‚  â”‚  â€¢ Automatic Backups                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Monitoring & Logging                    â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  â€¢ Supabase Dashboard                               â”‚  â”‚
â”‚  â”‚  â€¢ GitHub Actions Logs                              â”‚  â”‚
â”‚  â”‚  â€¢ Application Logs (console)                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## File Structure

```
InvestX Labs/
â”‚
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â””â”€â”€ services/
â”‚   â”‚       â””â”€â”€ userService.js          â­ Main Service
â”‚   â”‚
â”‚   â”œâ”€â”€ __tests__/
â”‚   â”‚   â””â”€â”€ userService.test.js         ğŸ§ª Unit Tests
â”‚   â”‚
â”‚   â”œâ”€â”€ scripts/
â”‚   â”‚   â”œâ”€â”€ testUserService.js          ğŸ§ª Service Tests
â”‚   â”‚   â””â”€â”€ testIntegration.js          ğŸ§ª Integration Tests
â”‚   â”‚
â”‚   â””â”€â”€ package.json                     ğŸ“¦ NPM Scripts
â”‚
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ scripts/
â”‚   â”‚   â””â”€â”€ checkSupabaseRPCs.js        ğŸ” Health Check
â”‚   â”‚
â”‚   â””â”€â”€ supabase/
â”‚       â””â”€â”€ migrations/
â”‚           â””â”€â”€ 20250125000000_verify_user_rpcs.sql  ğŸ—„ï¸ SQL
â”‚
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ user-service-tests.yml      ğŸš€ CI/CD
â”‚
â””â”€â”€ Documentation/
    â”œâ”€â”€ USER_SERVICE_IMPLEMENTATION.md   ğŸ“š Implementation
    â”œâ”€â”€ USER_SERVICE_TESTING_GUIDE.md    ğŸ“š Testing Guide
    â”œâ”€â”€ USER_SERVICE_VALIDATION_COMPLETE.md  ğŸ“š Summary
    â”œâ”€â”€ USER_SERVICE_ARCHITECTURE.md     ğŸ“š This File
    â””â”€â”€ QUICK_TEST_REFERENCE.md          ğŸ“š Quick Ref
```

---

**Last Updated**: January 25, 2025  
**Version**: 1.0.0  
**Status**: âœ… Production Ready
