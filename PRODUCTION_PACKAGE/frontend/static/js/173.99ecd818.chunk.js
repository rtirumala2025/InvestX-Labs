"use strict";(self.webpackChunkinvestx_labs=self.webpackChunkinvestx_labs||[]).push([[173],{3227:(e,t,a)=>{a.d(t,{y:()=>c});var o=a(7405),r=a(8878),l=a(5804),n=a(6870),s=a(2486);const c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];console.log("\ud83d\ude80 [useAlphaVantageData] Hook initialized with",e.length,"holdings");const{queueToast:t}=(0,s.nm)(),[a,c]=(0,r.useState)({}),[i,u]=(0,r.useState)(null),[g,d]=(0,r.useState)(!1),[h,m]=(0,r.useState)(null),[p,v]=(0,r.useState)(null),f=(0,r.useMemo)(()=>{const t=e.map(e=>e.symbol).filter(Boolean),a=[...new Set(t)];return console.log("\ud83d\ude80 [useAlphaVantageData] Extracted symbols:",a),a},[e]);console.log("\ud83d\ude80 [useAlphaVantageData] Holdings snapshot:",e.length);const S=(0,r.useCallback)(async()=>{if(console.log("\ud83d\ude80 [useAlphaVantageData] fetchMarketData triggered for",f.length,"symbols"),0===f.length)return console.log("\ud83d\ude80 [useAlphaVantageData] \u26a0\ufe0f No symbols to fetch - empty portfolio detected"),c({}),u((0,l.WI)([],{})),void d(!1);try{d(!0),m(null),console.log("\ud83d\ude80 [useAlphaVantageData] \ud83d\udcf6 Fetching market data for symbols:",f);const t=await(0,l.c2)(f);console.log("\ud83d\ude80 [useAlphaVantageData] \ud83d\udce5 Market data received:",Object.keys(t).length,"quotes"),console.log("\ud83d\ude80 [useAlphaVantageData] \ud83d\udcca Quote summary:",Object.entries(t).map(e=>{let[t,a]=e;return"".concat(t,": $").concat((null===a||void 0===a?void 0:a.price)||"N/A")})),c(t),console.log("\ud83d\ude80 [useAlphaVantageData] \ud83e\uddee Calculating live portfolio metrics...");const a=(0,l.WI)(e,t);console.log("\ud83d\ude80 [useAlphaVantageData] \u2705 Live metrics calculated:",{totalValue:a.totalValue,totalGainLoss:a.totalGainLoss,dayChange:a.dayChange,holdingsCount:a.holdings.length}),u(a),v((new Date).toISOString())}catch(a){console.error("\ud83d\ude80 [useAlphaVantageData] \u274c Error fetching market data:",a),m(a.message||"Failed to fetch market data");try{console.log("\ud83d\ude80 [useAlphaVantageData] \ud83d\udd04 Attempting Supabase fallback for market data.");const a=await(0,n.ls)(f);if(a&&Object.keys(a).length>0){c(a);const o=(0,l.WI)(e,a);return u(o),v((new Date).toISOString()),void t("Live price feed unavailable. Showing cached market data.","warning")}}catch(o){console.error("\ud83d\ude80 [useAlphaVantageData] \u274c Supabase fallback failed:",o)}console.log("\ud83d\ude80 [useAlphaVantageData] \ud83d\udd04 Using static portfolio calculations due to market data failure");const r=(0,l.WI)(e,{});u(r)}finally{d(!1)}},[f,e,t]),k=(0,r.useCallback)(async e=>{try{d(!0),m(null);const t=await(0,l.fn)(e);return t&&c(a=>(0,o.A)((0,o.A)({},a),{},{[e]:t})),t}catch(t){return console.error("Error fetching quote for",e,":",t),m(t.message||"Failed to fetch quote for ".concat(e)),null}finally{d(!1)}},[]);(0,r.useEffect)(()=>{console.log("\ud83d\ude80 [useAlphaVantageData] \ud83d\udd04 Holdings changed, triggering market data fetch"),S()},[S]);const b=(0,r.useCallback)(()=>S(),[S]),y=(0,r.useCallback)(e=>a[e]||null,[a]),D=(0,r.useCallback)(()=>{if(!p)return!0;const e=Date.now()-3e5,t=new Date(p).getTime()<e;return t&&console.log("\ud83d\ude80 [useAlphaVantageData] \u23f0 Data is stale - last updated:",p),t},[p]);return{marketData:a,portfolioMetrics:i,loading:g,error:h,lastUpdated:p,fetchMarketData:S,fetchQuote:k,refreshData:b,getQuoteBySymbol:y,isDataStale:D,hasData:Object.keys(a).length>0}}},5804:(e,t,a)=>{a.d(t,{WI:()=>u,c2:()=>i,fn:()=>c});var o=a(7405);const r={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_ALPHA_VANTAGE_BASE_URL||"https://www.alphavantage.co/query",l={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_ALPHA_VANTAGE_API_KEY,n=new Map,s="investx_market_cache",c=async e=>{if(console.log("\ud83d\udcc8 [MarketService] getQuote() called for symbol:",e),!e)return console.warn("\ud83d\udcc8 [MarketService] \u274c No symbol provided"),null;if(!l)return console.warn("\ud83d\udcc8 [MarketService] \u274c Alpha Vantage API key not found in environment variables"),null;const t=e.toUpperCase(),a=n.get(t),c=a?Date.now()-a.timestamp:null;if(a&&c<6e4)return console.log("\ud83d\udcc8 [MarketService] \ud83c\udfaf Cache HIT for",e,"- age:",Math.round(c/1e3),"seconds"),a.data;a?console.log("\ud83d\udcc8 [MarketService] \u23f0 Cache MISS for",e,"- stale data, age:",Math.round(c/1e3),"seconds"):console.log("\ud83d\udcc8 [MarketService] \ud83c\udd95 Cache MISS for",e,"- no cached data");try{const a=localStorage.getItem(s);if(a){const o=JSON.parse(a)[t];if(o&&Date.now()-o.timestamp<3e5)return console.log("\ud83d\udcc8 [MarketService] \ud83d\udcbe localStorage Cache HIT for",e),n.set(t,o),o.data}}catch(u){console.warn("\ud83d\udcc8 [MarketService] Error reading localStorage cache:",u)}try{var i;const a="".concat(r,"?function=GLOBAL_QUOTE&symbol=").concat(encodeURIComponent(e),"&apikey=").concat(l);console.log("\ud83d\udcc8 [MarketService] \ud83c\udf10 Sending API request to Alpha Vantage:",a.replace(l,"API_KEY_HIDDEN"));const o=await fetch(a);if(!o.ok)throw new Error("HTTP error! status: ".concat(o.status));const c=await o.json();if(console.log("\ud83d\udcc8 [MarketService] \ud83d\udce5 Raw API response received for",e,":",Object.keys(c)),c["Error Message"])return console.error("\ud83d\udcc8 [MarketService] \u274c Alpha Vantage API Error:",c["Error Message"]),null;if(c.Note)return console.warn("\ud83d\udcc8 [MarketService] \u26a0\ufe0f Alpha Vantage API Note (rate limit):",c.Note),null;const g=c["Global Quote"];if(!g)return console.error("\ud83d\udcc8 [MarketService] \u274c No quote data found for symbol:",e),null;console.log("\ud83d\udcc8 [MarketService] \ud83d\udcca Raw quote data for",e,":",g);const d={symbol:g["01. symbol"],open:parseFloat(g["02. open"])||0,high:parseFloat(g["03. high"])||0,low:parseFloat(g["04. low"])||0,price:parseFloat(g["05. price"])||0,volume:parseInt(g["06. volume"])||0,latestTradingDay:g["07. latest trading day"],previousClose:parseFloat(g["08. previous close"])||0,change:parseFloat(g["09. change"])||0,changePercent:parseFloat(null===(i=g["10. change percent"])||void 0===i?void 0:i.replace("%",""))||0};console.log("\ud83d\udcc8 [MarketService] \u2705 Transformed quote for",e,":",{price:d.price,change:d.change,changePercent:d.changePercent,previousClose:d.previousClose});const h={data:d,timestamp:Date.now()};n.set(t,h);try{const e=localStorage.getItem(s),a=e?JSON.parse(e):{};a[t]=h;const o=Object.keys(a);if(o.length>50){o.sort((e,t)=>(a[e].timestamp||0)-(a[t].timestamp||0)).slice(0,o.length-50).forEach(e=>delete a[e])}localStorage.setItem(s,JSON.stringify(a))}catch(u){console.warn("\ud83d\udcc8 [MarketService] Error writing to localStorage cache:",u)}return console.log("\ud83d\udcc8 [MarketService] \ud83d\udcbe Cached quote for",e,"- cache size:",n.size),d}catch(g){console.error("\ud83d\udcc8 [MarketService] \u274c Error fetching quote for",e,":",g);const a=n.get(t);if(a)return console.log("\ud83d\udcc8 [MarketService] \ud83d\udd04 Returning stale in-memory cached data as fallback for",e),a.data;try{const a=localStorage.getItem(s);if(a){const r=JSON.parse(a)[t];if(r)return console.log("\ud83d\udcc8 [MarketService] \ud83d\udd04 Returning stale localStorage cached data as fallback for",e,"(may be outdated)"),(0,o.A)((0,o.A)({},r.data),{},{_stale:!0,_staleWarning:"Market data may be outdated. Please refresh."})}}catch(u){console.warn("\ud83d\udcc8 [MarketService] Error reading localStorage cache on error fallback:",u)}return null}},i=async e=>{if(console.log("\ud83d\udcc8 [MarketService] getMultipleQuotes() called for",e.length,"symbols:",e),!e||0===e.length)return console.log("\ud83d\udcc8 [MarketService] \u26a0\ufe0f No symbols provided to getMultipleQuotes"),{};const t={};console.log("\ud83d\udcc8 [MarketService] \ud83d\udd04 Processing",e.length,"symbols in batches of",5);for(let r=0;r<e.length;r+=5){const a=e.slice(r,r+5),l=Math.floor(r/5)+1,n=Math.ceil(e.length/5);console.log("\ud83d\udcc8 [MarketService] \ud83d\udce6 Processing batch",l,"of",n,":",a);try{const o=a.map(e=>c(e)),n=await Promise.all(o);console.log("\ud83d\udcc8 [MarketService] \u2705 Batch",l,"completed - received",n.filter(e=>null!==e).length,"valid quotes"),a.forEach((e,a)=>{t[e]=n[a]}),r+5<e.length&&(console.log("\ud83d\udcc8 [MarketService] \u23f3 Waiting 12 seconds before next batch to respect rate limits..."),await new Promise(e=>setTimeout(e,12e3)),console.log("\ud83d\udcc8 [MarketService] \u23f0 Delay complete, proceeding to next batch"))}catch(o){console.error("\ud83d\udcc8 [MarketService] \u274c Error fetching batch",l,":",o)}}const a=Object.values(t).filter(e=>null!==e).length;return console.log("\ud83d\udcc8 [MarketService] \ud83c\udfaf getMultipleQuotes completed:",a,"successful out of",e.length,"requested"),t},u=(e,t)=>{if(!e||0===e.length)return{totalValue:0,totalCostBasis:0,totalGainLoss:0,totalGainLossPercentage:0,dayChange:0,dayChangePercentage:0,holdings:[]};let a=0,r=0,l=0;const n=e.map(e=>{const n=t[e.symbol],s=(null===n||void 0===n?void 0:n.price)||e.purchasePrice||0,c=(null===n||void 0===n?void 0:n.previousClose)||e.purchasePrice||0,i=e.shares*s,u=e.shares*e.purchasePrice,g=i-u,d=u>0?g/u*100:0,h=e.shares*(s-c),m=c>0?(s-c)/c*100:0;return a+=i,r+=u,l+=h,(0,o.A)((0,o.A)({},e),{},{currentPrice:s,previousClose:c,value:i,gainLoss:g,gainLossPercentage:d,dayChange:h,dayChangePercentage:m,lastUpdated:(new Date).toISOString()})}),s=a-r;return{totalValue:a,totalCostBasis:r,totalGainLoss:s,totalGainLossPercentage:r>0?s/r*100:0,dayChange:l,dayChangePercentage:a-l>0?l/(a-l)*100:0,holdings:n,lastUpdated:(new Date).toISOString()}}},9191:(e,t,a)=>{a.d(t,{A:()=>u});var o=a(8878),r=a(3282),l=a(3499),n=a(5875),s=a(782);r.t1.register(r.PP,r.kc,r.FN,r.No,r.hE,r.m_,r.s$,r.dN);const c={"1D":1,"1W":7,"1M":30,"3M":90,"1Y":365,ALL:null},i=e=>{var t;let{portfolio:a,holdings:r=[],transactions:i=[],marketData:u={},timeframe:g="1M",loading:d=!1,error:h=null}=e;const m=(0,o.useMemo)(()=>{var e;const t=(null===a||void 0===a||null===(e=a.metadata)||void 0===e?void 0:e.historicalData)||[];return t.length?t.map(e=>({date:e.date,value:e.value})):[]},[null===a||void 0===a||null===(t=a.metadata)||void 0===t?void 0:t.historicalData]),p=(0,o.useMemo)(()=>{if(m.length>1)return m;if(0===i.length){const e=r.reduce((e,t)=>e+(t.current_price||t.purchase_price||0)*t.shares,0);return e>0?[{date:(new Date).toISOString(),value:e}]:[]}const e=[...i].filter(e=>e.transaction_date).sort((e,t)=>new Date(e.transaction_date)-new Date(t.transaction_date));let t=0;const a=[];e.forEach(e=>{const o=Number(e.total_amount)||0;t+=o,a.push({date:e.transaction_date,value:Math.max(0,-1*t)})});const o=r.reduce((e,t)=>{const a=null===u||void 0===u?void 0:u[t.symbol];return e+((null===a||void 0===a?void 0:a.price)||t.current_price||t.purchase_price||0)*t.shares},0);return o>0&&a.push({date:(new Date).toISOString(),value:o}),a},[i,r,u,m]),v=(0,o.useMemo)(()=>{var e;const t=m.length?m:p;if(!t.length)return[];const a=null!==(e=c[g])&&void 0!==e?e:null,o=a?Date.now()-24*a*60*60*1e3:null;return t.filter(e=>{if(null===e||void 0===e||!e.date)return!1;const t=new Date(e.date).getTime();return!Number.isNaN(t)&&(!o||t>=o)}).map(e=>({label:new Date(e.date).toLocaleDateString(void 0,{month:"short",day:"numeric"}),value:Number(e.value)||0}))},[m,p,g]),f=(0,o.useMemo)(()=>v.length?{labels:v.map(e=>e.label),datasets:[{label:"Portfolio Value",data:v.map(e=>e.value),borderColor:"rgba(59, 130, 246, 1)",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.35,fill:!0,pointRadius:3,pointHoverRadius:5}]}:null,[v]),S=(0,o.useMemo)(()=>({responsive:!0,maintainAspectRatio:!1,interaction:{intersect:!1,mode:"index"},plugins:{legend:{display:!1},tooltip:{callbacks:{label:e=>"$".concat((e.parsed.y||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))}}},scales:{y:{ticks:{callback:e=>"$".concat(e.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})),color:"rgba(255, 255, 255, 0.6)"},grid:{color:"rgba(255, 255, 255, 0.08)"}},x:{ticks:{color:"rgba(255, 255, 255, 0.6)"},grid:{display:!1}}}}),[]);return d?(0,s.jsx)("div",{className:"h-80 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center text-white/80",children:[(0,s.jsx)(n.Ay,{size:"large"}),(0,s.jsx)("p",{className:"mt-4",children:"Loading portfolio performance..."})]})}):h?(0,s.jsx)("div",{className:"h-80 flex items-center justify-center",children:(0,s.jsxs)("p",{className:"text-red-300",children:["\u26a0\ufe0f ",h]})}):!f||f.datasets[0].data.every(e=>0===e)?(0,s.jsx)("div",{className:"h-80 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center text-white/70",children:[(0,s.jsx)("div",{className:"text-4xl mb-3",children:"\ud83d\udcc8"}),(0,s.jsx)("p",{className:"font-semibold mb-1",children:"Add holdings to see performance data"}),(0,s.jsx)("p",{className:"text-sm text-white/50",children:"We\\'ll start charting your portfolio as soon as you add your first investment."})]})}):(0,s.jsx)("div",{className:"h-80",children:(0,s.jsx)(l.N1,{data:f,options:S})})},u=o.memo(i)}}]);